package com.brainydroid.daydreaming.db;

import android.content.Context;
import android.location.Location;
import android.util.Log;
import com.brainydroid.daydreaming.ui.Config;
import com.google.gson.annotations.Expose;

import java.util.ArrayList;

public class LocationItem {

	private static String TAG = "LocationItem";

	private transient int _id;

    @Expose private double locationLatitude;
    @Expose private double locationLongitude;
    @Expose private double locationAltitude;
    @Expose private double locationAccuracy;
    @Expose private long timestamp;

    public static final String COL_ID = "locationId";
    public static final String COL_LOCATION_LATITUDE = "locationLocationLatitude";
    public static final String COL_LOCATION_LONGITUDE = "locationLocationLongitude";
    public static final String COL_LOCATION_ALTITUDE = "locationLocationAltitude";
    public static final String COL_LOCATION_ACCURACY = "locationLocationAccuracy";
    public static final String COL_TIMESTAMP = "locationTimestamp";

	private transient final Context _context;
	private transient final LocationsStorage locationsStorage;

	public LocationItem(Context context) {

		// Debug
		if (Config.LOGD) {
			Log.d(TAG, "[fn] LocationItem");
		}

		_context = context.getApplicationContext();
		_id = -1;
        locationsStorage = LocationsStorage.getInstance(_context);
	}

	public int getId() {

		// Verbose
		if (Config.LOGV) {
			Log.v(TAG, "[fn] getId");
		}

		return _id;
	}

	public void setId(int id) {

		// Verbose
		if (Config.LOGV) {
			Log.v(TAG, "[fn] setId");
		}

		_id = id;
        // Don't call saveIfSync() here since setId is only called from LocationsStorage, to set an id
        // generated by a save operation.
	}

    public double getLocationLatitude() {

        // Verbose
        if (Config.LOGV) {
            Log.v(TAG, "[fn] getLocationLatitude");
        }

        return locationLatitude;
    }

    public double getLocationLongitude() {

        // Verbose
        if (Config.LOGV) {
            Log.v(TAG, "[fn] getLocationLongitude");
        }

        return locationLongitude;
    }

    public double getLocationAltitude() {

        // Verbose
        if (Config.LOGV) {
            Log.v(TAG, "[fn] getLocationAltitude");
        }

        return locationAltitude;
    }

    public double getLocationAccuracy() {

        // Verbose
        if (Config.LOGV) {
            Log.v(TAG, "[fn] getLocationAccuracy");
        }

        return locationAccuracy;
    }

    public void setLocationLatitude(double locationLatitude) {

        // Debug
        if (Config.LOGD) {
            Log.d(TAG, "[fn] setLocationLatitude");
        }

        this.locationLatitude = locationLatitude;
        saveIfSync();
    }

    public void setLocationLongitude(double locationLongitude) {

        // Debug
        if (Config.LOGD) {
            Log.d(TAG, "[fn] setLocationLongitude");
        }

        this.locationLongitude = locationLongitude;
        saveIfSync();
    }

    public void setLocationAltitude(double locationAltitude) {

        // Debug
        if (Config.LOGD) {
            Log.d(TAG, "[fn] setLocationAltitude");
        }

        this.locationAltitude = locationAltitude;
        saveIfSync();
    }

    public void setLocationAccuracy(double locationAccuracy) {

        // Debug
        if (Config.LOGD) {
            Log.d(TAG, "[fn] setLocationAccuracy");
        }

        this.locationAccuracy = locationAccuracy;
        saveIfSync();
    }

    public void setLocation(Location location) {

        // Debug
        if (Config.LOGD) {
            Log.d(TAG, "[fn] setLocation");
        }

        if (location != null) {
            locationLatitude = location.getLatitude();
            locationLongitude = location.getLongitude();
            locationAltitude = location.getAltitude();
            locationAccuracy = location.getAccuracy();
        }
        saveIfSync();
    }

    public long getTimestamp() {

        // Verbose
        if (Config.LOGV) {
            Log.v(TAG, "[fn] getTimestamp");
        }

        return timestamp;
    }

    public void setTimestamp(long timestamp) {

        // Debug
        if (Config.LOGD) {
            Log.d(TAG, "[fn] setTimestamp");
        }

        this.timestamp = timestamp;
        saveIfSync();
    }

	private void saveIfSync() {

		// Debug
		if (Config.LOGD) {
			Log.d(TAG, "[fn] saveIfSync");
		}

		if (_id != -1) {
			save();
		}
	}

	public void save() {

		// Debug
		if (Config.LOGD) {
			Log.d(TAG, "[fn] save");
		}

		if (_id != -1) {
			locationsStorage.updateLocationItem(this);
		} else {
			locationsStorage.storeLocationItemGetId(this);
		}
	}
}
